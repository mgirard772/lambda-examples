# Overview
This is a basic lambda function that responds with `hello {input}`, with `{input}` being
the message that it sent in the request.

# Makefile
A makefile is included to provide shortcuts to basic commands. 
These shortuts will be used in this readme. To see the actual commands,
review the makefile.

# Local Testing
There are two ways to test a lambda locally: 

1. Start a local version of API gateway and send requests via curl that mimic what you would send
in a production environment. 
2. Invoke the lambda directly using an event that
models what is generated by API Gateway after a request is received.

## API
Build the function and start the local API
```bash
make start-local-api
```

In a separate terminal, send a curl request to the local API. The data sent is stored under
`events/curl-hello.json`
```bash
make test-local-api
```

## Invocation
Build and invoke the lambda with an event. The event is stored under `events/event.json`
```bash
make local-invoke
```

# Deployment
The below make command will build and deploy the function based on the values stored in `samconfig.toml`.
This file is generated by the gen-config.sh file using the sameconfig-template.toml file.
To set the StageName, set StageName before the make command. The config is generated with
each call to the deploy target.

```bash
StageName=test make deploy
```

# Remote Testing
Once the function has been deployed you can test the remote API gateway.
The `deploy` command will output the endpoint of the deployed function.

```commandline
Key                 HelloWorldApi                                                                                                                                                          
Description         API Gateway endpoint URL for Prod stage for Hello World function                                                                                                       
Value               https://du4d63evy9.execute-api.us-east-1.amazonaws.com/matt/hello  
```

Before calling the API, you need to get the API key for the endpoint from the AWS console.
The link to get this key is output in the console as well:

```commandline
Key                 HelloWorldApiKey                                                                                                                                                       
Description         You can find your API Key in the AWS console: (Put in the request HEADER as x-api-key)                                                                                 
Value               https://console.aws.amazon.com/apigateway/home?region=us-east-1#/api-keys/kk6fo5a4s5  
```
You can use the above link to get the API key using the API. Alternatively you can use the AWS CLI
to get the key in the terminal:

```bash
aws apigateway get-api-key --api-key ${API_KEY_ID} --include-value
```

# Cleanup
To delete the stack, use the following make command
```bash
make delete
```